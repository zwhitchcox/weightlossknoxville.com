---
import BaseLayout from '../layouts/BaseLayout.astro';
import { SITE_URL, PHONE, EMAIL, LOCATIONS } from '../consts';

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'ContactPage',
  name: 'Contact Weight Loss Knox',
  url: `${SITE_URL}/contact/`,
  mainEntity: {
    '@type': 'MedicalBusiness',
    name: 'Weight Loss Knox',
    telephone: PHONE,
    email: EMAIL,
    address: [
      {
        '@type': 'PostalAddress',
        streetAddress: `${LOCATIONS.bearden.street}, ${LOCATIONS.bearden.suite}`,
        addressLocality: LOCATIONS.bearden.city,
        addressRegion: LOCATIONS.bearden.state,
        postalCode: LOCATIONS.bearden.zip,
        addressCountry: 'US',
      },
      {
        '@type': 'PostalAddress',
        streetAddress: `${LOCATIONS.farragut.street}, ${LOCATIONS.farragut.suite}`,
        addressLocality: LOCATIONS.farragut.city,
        addressRegion: LOCATIONS.farragut.state,
        postalCode: LOCATIONS.farragut.zip,
        addressCountry: 'US',
      },
    ],
    openingHoursSpecification: [
      {
        '@type': 'OpeningHoursSpecification',
        dayOfWeek: ['Monday', 'Tuesday', 'Wednesday', 'Thursday'],
        opens: '08:00',
        closes: '17:00',
      },
      {
        '@type': 'OpeningHoursSpecification',
        dayOfWeek: 'Friday',
        opens: '08:00',
        closes: '15:00',
      },
    ],
  },
};
---

<BaseLayout
  title="Contact Us | Weight Loss Knox | Knoxville TN"
  description="Contact Weight Loss Knox to schedule your medical weight loss consultation. Two locations in Knoxville: Bearden and Farragut. Call us or fill out our online form today."
>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  </Fragment>

  <!-- Hero -->
  <section class="relative overflow-hidden bg-primary-dark text-white px-4 py-16 sm:px-6 sm:py-20 lg:px-8">
    <div class="absolute inset-0 opacity-10">
      <svg class="h-full w-full" viewBox="0 0 100 100" preserveAspectRatio="none">
        <path d="M0 100 C 20 0 50 0 100 100 Z" fill="white" />
      </svg>
    </div>
    <div class="relative mx-auto max-w-4xl text-center">
      <h1 class="font-serif text-4xl font-bold leading-tight sm:text-5xl">Contact Us</h1>
      <p class="mx-auto mt-4 max-w-2xl text-lg text-neutral-300">
        Ready to start your weight loss journey? Schedule a consultation or reach out with any questions.
        We have two convenient locations in Knoxville and Farragut.
      </p>
    </div>
  </section>

  <!-- Contact Form + Info -->
  <section class="bg-neutral-50 px-4 py-16 sm:px-6 sm:py-20 lg:px-8">
    <div class="mx-auto grid max-w-6xl gap-12 lg:grid-cols-3">

      <!-- Contact Form -->
      <div class="lg:col-span-2">
        <div class="rounded-2xl bg-white p-8 shadow-card border border-neutral-100">
          <h2 class="font-serif text-2xl font-bold text-primary">Schedule a Consultation</h2>
          <p class="mt-2 text-sm text-neutral-500">
            Fill out the form below and our team will contact you within one business day.
          </p>

          <div id="form-status" class="hidden rounded-lg p-4 mb-4 text-sm"></div>
          <form id="contact-form" class="mt-8 space-y-6">
            <div class="grid gap-6 sm:grid-cols-2">
              <div>
                <label for="firstName" class="block text-sm font-medium text-neutral-700">First Name *</label>
                <input
                  type="text"
                  id="firstName"
                  name="firstName"
                  required
                  class="mt-1.5 block w-full rounded-lg border border-neutral-200 px-4 py-3 text-sm text-neutral-800 shadow-sm transition-colors focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none bg-neutral-50"
                />
              </div>
              <div>
                <label for="lastName" class="block text-sm font-medium text-neutral-700">Last Name *</label>
                <input
                  type="text"
                  id="lastName"
                  name="lastName"
                  required
                  class="mt-1.5 block w-full rounded-lg border border-neutral-200 px-4 py-3 text-sm text-neutral-800 shadow-sm transition-colors focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none bg-neutral-50"
                />
              </div>
            </div>

            <div class="grid gap-6 sm:grid-cols-2">
              <div>
                <label for="email" class="block text-sm font-medium text-neutral-700">Email Address *</label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="mt-1.5 block w-full rounded-lg border border-neutral-200 px-4 py-3 text-sm text-neutral-800 shadow-sm transition-colors focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none bg-neutral-50"
                />
              </div>
              <div>
                <label for="phone" class="block text-sm font-medium text-neutral-700">Phone Number *</label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  required
                  class="mt-1.5 block w-full rounded-lg border border-neutral-200 px-4 py-3 text-sm text-neutral-800 shadow-sm transition-colors focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none bg-neutral-50"
                />
              </div>
            </div>

            <div class="grid gap-6 sm:grid-cols-2">
              <div>
                <label for="location" class="block text-sm font-medium text-neutral-700">Preferred Location</label>
                <select
                  id="location"
                  name="location"
                  class="mt-1.5 block w-full rounded-lg border border-neutral-200 px-4 py-3 text-sm text-neutral-800 shadow-sm transition-colors focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none bg-neutral-50"
                >
                  <option value="">Select a location</option>
                  <option value="bearden">Bearden (Knoxville)</option>
                  <option value="farragut">Farragut</option>
                </select>
              </div>
              <div>
                <label for="interest" class="block text-sm font-medium text-neutral-700">I'm interested in...</label>
                <select
                  id="interest"
                  name="interest"
                  class="mt-1.5 block w-full rounded-lg border border-neutral-200 px-4 py-3 text-sm text-neutral-800 shadow-sm transition-colors focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none bg-neutral-50"
                >
                  <option value="">Select an option</option>
                  <option value="tirzepatide">Tirzepatide (Mounjaro/Zepbound)</option>
                  <option value="semaglutide">Semaglutide (Wegovy/Ozempic)</option>
                  <option value="botox">Botox / Dysport / Jeuveau</option>
                  <option value="filler">Dermal Fillers</option>
                  <option value="laser">Laser Treatments</option>
                  <option value="microneedling">Microneedling</option>
                  <option value="chemical-peel">Chemical Peels</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>

            <div>
              <label for="referral" class="block text-sm font-medium text-neutral-700">How did you hear about us?</label>
              <select
                id="referral"
                name="referral"
                class="mt-1.5 block w-full rounded-lg border border-neutral-200 px-4 py-3 text-sm text-neutral-800 shadow-sm transition-colors focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none bg-neutral-50"
              >
                <option value="">Select an option</option>
                <option value="google">Google Search</option>
                <option value="referral">Friend/Family Referral</option>
                <option value="doctor">Doctor Referral</option>
                <option value="social">Social Media</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div>
              <label for="message" class="block text-sm font-medium text-neutral-700">Message</label>
              <textarea
                id="message"
                name="message"
                rows="4"
                class="mt-1.5 block w-full rounded-lg border border-neutral-200 px-4 py-3 text-sm text-neutral-800 shadow-sm transition-colors focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none bg-neutral-50"
                placeholder="Tell us about your goals or any questions you have..."
              ></textarea>
            </div>

            <button
              type="submit"
              class="w-full rounded-xl bg-accent px-8 py-4 text-base font-bold text-primary-dark shadow-lg transition-all hover:bg-accent-light hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 sm:w-auto"
            >
              Submit Request
            </button>

            <p class="text-xs text-neutral-400">
              By submitting this form, you consent to be contacted by Weight Loss Knox about our services via phone, email, and SMS/text message. Message frequency may vary. Message and data rates may apply. Reply STOP to opt out of SMS at any time. Reply HELP for assistance. SMS consent is not shared with third parties. See our <a href="/privacy/" class="underline hover:text-neutral-600">Privacy Policy</a> and <a href="/terms/" class="underline hover:text-neutral-600">Terms & Conditions</a>.
            </p>
          </form>
        </div>
      </div>

      <!-- Contact Info Sidebar -->
      <div class="space-y-8">
        <!-- Bearden Location -->
        <div class="rounded-2xl bg-white p-6 shadow-sm border border-neutral-100">
          <h3 class="font-serif text-lg font-bold text-primary">Bearden Location</h3>
          <address class="mt-3 text-sm not-italic leading-relaxed text-neutral-600">
            {LOCATIONS.bearden.street}<br />
            {LOCATIONS.bearden.suite}<br />
            <span class="text-neutral-400 text-xs">{LOCATIONS.bearden.inside}</span><br />
            {LOCATIONS.bearden.city}, {LOCATIONS.bearden.state} {LOCATIONS.bearden.zip}
          </address>
          <a href={`tel:${LOCATIONS.bearden.phone.replace(/[^0-9+]/g, '')}`} class="mt-2 block text-sm text-primary hover:text-primary-light font-medium">
            {LOCATIONS.bearden.phone}
          </a>
        </div>

        <!-- Farragut Location -->
        <div class="rounded-2xl bg-white p-6 shadow-sm border border-neutral-100">
          <h3 class="font-serif text-lg font-bold text-primary">Farragut Location</h3>
          <address class="mt-3 text-sm not-italic leading-relaxed text-neutral-600">
            {LOCATIONS.farragut.street}<br />
            {LOCATIONS.farragut.suite}<br />
            <span class="text-neutral-400 text-xs">{LOCATIONS.farragut.inside}</span><br />
            {LOCATIONS.farragut.city}, {LOCATIONS.farragut.state} {LOCATIONS.farragut.zip}
          </address>
          <a href={`tel:${LOCATIONS.farragut.phone.replace(/[^0-9+]/g, '')}`} class="mt-2 block text-sm text-primary hover:text-primary-light font-medium">
            {LOCATIONS.farragut.phone}
          </a>
        </div>

        <!-- Email -->
        <div class="rounded-2xl bg-white p-6 shadow-sm border border-neutral-100">
          <h3 class="font-serif text-lg font-bold text-primary">Email</h3>
          <div class="mt-3">
            <a href={`mailto:${EMAIL}`} class="text-sm text-primary hover:text-primary-light font-medium">
              {EMAIL}
            </a>
          </div>
        </div>

        <!-- Hours -->
        <div class="rounded-2xl bg-white p-6 shadow-sm border border-neutral-100">
          <h3 class="font-serif text-lg font-bold text-primary">Office Hours</h3>
          <div class="mt-3 space-y-2 text-sm text-neutral-600">
            <div class="flex justify-between border-b border-neutral-100 pb-2">
              <span>Mon - Thu</span>
              <span class="font-medium text-neutral-800">8:00 AM - 5:00 PM</span>
            </div>
            <div class="flex justify-between border-b border-neutral-100 pb-2">
              <span>Friday</span>
              <span class="font-medium text-neutral-800">8:00 AM - 3:00 PM</span>
            </div>
            <div class="flex justify-between pt-1">
              <span>Sat - Sun</span>
              <span class="font-medium text-neutral-800">Closed</span>
            </div>
          </div>
        </div>

        <!-- Quick Call CTA -->
        <div class="rounded-2xl bg-primary p-6 text-white shadow-lg">
          <h3 class="font-serif text-lg font-bold">Prefer to Call?</h3>
          <p class="mt-2 text-sm text-primary-light/90">
            Speak directly with our team to schedule your consultation or ask questions.
          </p>
          <a
            href={`tel:${LOCATIONS.bearden.phone.replace(/[^0-9+]/g, '')}`}
            class="mt-4 inline-flex w-full items-center justify-center rounded-lg bg-white px-6 py-3 text-sm font-bold text-primary transition-colors hover:bg-neutral-100"
          >
            Bearden: {LOCATIONS.bearden.phone}
          </a>
          <a
            href={`tel:${LOCATIONS.farragut.phone.replace(/[^0-9+]/g, '')}`}
            class="mt-2 inline-flex w-full items-center justify-center rounded-lg bg-white/10 px-6 py-3 text-sm font-bold text-white transition-colors hover:bg-white/20 border border-white/20"
          >
            Farragut: {LOCATIONS.farragut.phone}
          </a>
        </div>
      </div>
    </div>
  </section>

  <script>
    const form = document.getElementById('contact-form') as HTMLFormElement | null;
    const status = document.getElementById('form-status');

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();

      const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement | null;
      const originalText = submitBtn?.textContent || '';

      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
      }

      if (status) {
        status.classList.add('hidden');
      }

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        const res = await fetch('/api/contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });

        const result = await res.json();

        if (status) {
          status.classList.remove('hidden');
          if (res.ok) {
            status.className = 'rounded-lg p-4 mb-4 text-sm bg-green-50 text-green-800 border border-green-200';
            status.textContent = result.message;
            form.reset();
          } else {
            status.className = 'rounded-lg p-4 mb-4 text-sm bg-red-50 text-red-800 border border-red-200';
            status.textContent = result.error || 'Something went wrong. Please try again.';
          }
        }
      } catch {
        if (status) {
          status.classList.remove('hidden');
          status.className = 'rounded-lg p-4 mb-4 text-sm bg-red-50 text-red-800 border border-red-200';
          status.textContent = 'Network error. Please try again or call us directly.';
        }
      } finally {
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }
      }
    });
  </script>
</BaseLayout>
