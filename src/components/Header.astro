---
import { NAV_LINKS } from '../consts';

const currentPath = Astro.url.pathname;
---

<header 
  class="sticky top-0 z-50 w-full border-b border-neutral-200 bg-white/95 backdrop-blur-md transition-all duration-300"
  id="main-header"
>
  <div class="mx-auto flex h-20 max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-3 group">
      <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary text-white transition-transform group-hover:scale-105">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="h-6 w-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
        </svg>          
      </div>
      <div class="flex flex-col">
        <span class="font-serif text-xl font-bold leading-none text-primary group-hover:text-primary-dark transition-colors">Weight Loss Knox</span>
        <span class="text-[0.65rem] uppercase tracking-wider text-neutral-500 font-medium">Medical Weight Loss Clinic</span>
      </div>
    </a>

    <!-- Desktop Navigation -->
    <nav class="hidden items-center gap-1 xl:flex">
      {NAV_LINKS.map((link) => {
        const isActive = currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href));
        return (
          <a
            href={link.href}
            class:list={[
              "rounded-full px-4 py-2 text-sm font-medium transition-all duration-200",
              isActive 
                ? "bg-primary/10 text-primary font-semibold" 
                : "text-neutral-600 hover:bg-neutral-100 hover:text-primary"
            ]}
          >
            {link.label}
          </a>
        );
      })}
      <div class="ml-4 h-8 w-px bg-neutral-200"></div>
      <a
        href="/contact/"
        class="ml-4 inline-flex items-center justify-center rounded-full bg-primary px-6 py-2.5 text-sm font-semibold text-white shadow-md transition-all hover:bg-primary-dark hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0"
      >
        Book Consultation
      </a>
    </nav>

    <!-- Mobile Hamburger Button -->
    <button
      id="mobile-menu-btn"
      type="button"
      class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-neutral-200 text-neutral-600 transition-colors hover:bg-neutral-50 hover:text-primary xl:hidden"
      aria-label="Toggle navigation menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <span class="sr-only">Open main menu</span>
      <svg id="hamburger-icon" class="h-6 w-6 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
      </svg>
      <svg id="close-icon" class="hidden h-6 w-6 transition-transform duration-300 rotate-90" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div 
    id="mobile-menu" 
    class="fixed inset-x-0 top-20 z-40 hidden h-[calc(100vh-5rem)] overflow-y-auto bg-white/98 backdrop-blur-xl transition-all duration-300 ease-in-out xl:hidden"
  >
    <nav class="flex flex-col space-y-2 px-6 py-8">
      {NAV_LINKS.map((link) => {
        const isActive = currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href));
        return (
          <a
            href={link.href}
            class:list={[
              "flex items-center rounded-xl px-4 py-3 text-base font-medium transition-colors",
              isActive 
                ? "bg-primary/10 text-primary font-semibold" 
                : "text-neutral-600 hover:bg-neutral-50 hover:text-primary"
            ]}
          >
            {link.label}
            {isActive && (
              <svg class="ml-auto h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
              </svg>
            )}
          </a>
        );
      })}
      
      <div class="mt-6 border-t border-neutral-100 pt-6">
        <a
          href="/contact/"
          class="flex w-full items-center justify-center rounded-xl bg-primary px-6 py-4 text-center text-base font-bold text-white shadow-lg transition-transform active:scale-[0.98]"
        >
          Book Your Consultation
        </a>
        <p class="mt-4 text-center text-sm text-neutral-500">
          Or call us at <a href="tel:8655550123" class="font-semibold text-primary">865-555-0123</a>
        </p>
      </div>
    </nav>
  </div>
</header>

<script>
  function setupMobileMenu() {
    const btn = document.getElementById('mobile-menu-btn');
    const menu = document.getElementById('mobile-menu');
    const hamburger = document.getElementById('hamburger-icon');
    const closeIcon = document.getElementById('close-icon');
    let isOpen = false;

    if (!btn || !menu) return;

    function toggleMenu() {
      isOpen = !isOpen;
      
      if (isOpen) {
        menu?.classList.remove('hidden');
        // Small timeout to allow display:block to apply before opacity transition if we added one
        requestAnimationFrame(() => {
          menu?.classList.add('opacity-100');
          hamburger?.classList.add('hidden');
          closeIcon?.classList.remove('hidden');
          // Rotate animation class
          closeIcon?.classList.remove('rotate-90'); 
        });
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
      } else {
        menu?.classList.remove('opacity-100');
        hamburger?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        closeIcon?.classList.add('rotate-90');
        menu?.classList.add('hidden');
        document.body.style.overflow = '';
      }
      
      btn?.setAttribute('aria-expanded', String(isOpen));
    }

    btn?.addEventListener('click', toggleMenu);

    // Close on resize if moving to desktop view
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 1280 && isOpen) {
        toggleMenu();
      }
    });
  }

  // Run on initial load
  setupMobileMenu();

  // Support Astro View Transitions if added later
  document.addEventListener('astro:page-load', setupMobileMenu);
</script>
